<!DOCTYPE html>
<html class="js-focus-visible" data-js-focus-visible=""><head><meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Embed API — Third Party Visualizations — Google Analytics Demos &amp; Tools</title>

    <link href="//fonts.googleapis.com/css?family=Open+Sans:600,400,300" rel="stylesheet">
    <link href="/public/css/index.css" rel="stylesheet">

    <meta name="viewport" content="width=device-width, initial-scale=1">





    <script src="https://apis.google.com/_/scs/apps-static/_/js/k=oz.gapi.ru.cT5jUD76onk.O/m=auth2/exm=analytics,client/rt=j/sv=1/d=1/ed=1/am=wQE/rs=AGLTcCNdQpkLT0Yl7damoIUETGlxC8Grxw/cb=gapi.loaded_2" async=""></script><script src="https://apis.google.com/_/scs/apps-static/_/js/k=oz.gapi.ru.cT5jUD76onk.O/m=client/exm=analytics/rt=j/sv=1/d=1/ed=1/am=wQE/rs=AGLTcCNdQpkLT0Yl7damoIUETGlxC8Grxw/cb=gapi.loaded_1" async=""></script><script src="https://apis.google.com/_/scs/apps-static/_/js/k=oz.gapi.ru.cT5jUD76onk.O/m=analytics/rt=j/sv=1/d=1/ed=1/am=wQE/rs=AGLTcCNdQpkLT0Yl7damoIUETGlxC8Grxw/cb=gapi.loaded_0" async=""></script><script src="https://apis.google.com/js/platform.js" gapi_processed="true"></script><script>
        addEventListener('error', window.__e=function f(e){f.q=f.q||[];f.q.push(e)});
    </script>
    <script async="" src="https://www.google-analytics.com/analytics.js"></script>

    <script>
        !function() {
            if (window.PerformanceLongTaskTiming) {
                var g = window.__tti = {e: []};
                g.o = new PerformanceObserver(function(l){
                    g.e=g.e.concat(l.getEntries())
                });
                g.o.observe({entryTypes:['longtask']});
            }
        }();
    </script>

    <script>
        window.__trackAbandons = () => {
            const ANALYTICS_URL = 'https://www.google-analytics.com/collect';
            const GA_COOKIE = document.cookie.replace(
                /(?:(?:^|.*;)\s*_ga\s*\=\s*(?:\w+\.\d\.)([^;]*).*$)|^.*$/, '$1');
            const TRACKING_ID = 'UA-41425441-7';
            const CLIENT_ID =  GA_COOKIE || (Math.random() * Math.pow(2, 52));

            navigator.sendBeacon && navigator.sendBeacon(ANALYTICS_URL, [
                'v=1', 't=event', 'ec=Load', 'ea=abandon', 'el=pre-load', 'ni=1',
                'tid=' + TRACKING_ID,
                'cid=' + CLIENT_ID,
                'cd9' + CLIENT_ID, // client ID custom dimension
                'ev=' + Math.round(performance.now()),
            ].join('&'));
        };
        window.addEventListener('unload', window.__trackAbandons);
    </script>


    <script>

        // Adds a progress bar if the page doesn't load after 1s.
        setTimeout(function() {
            var progressBar = document.createElement('div');
            progressBar.className = 'ProgressBar Header-progressIndicator';
            document.getElementById('header').appendChild(progressBar);
        }, 1000);

        (function(w,d,s,g,js,fs){
            g=w.gapi||(w.gapi={});g.analytics={q:[],ready:function(f){this.q.push(f);}};
            js=d.createElement(s);fs=d.getElementsByTagName(s)[0];
            js.src='https://apis.google.com/js/platform.js';
            fs.parentNode.insertBefore(js,fs);js.onload=function(){g.load('analytics');};
        }(window,document,'script'));

        gapi.analytics.ready(function() {

            function setSignedInState() {
                document.body.classList.remove('is-needingAuthorization');
                document.body.classList.add('is-authorized');
            }

            function setSignedOutState() {
                document.body.classList.remove('is-authorized');
                document.body.classList.add('is-needingAuthorization');
            }

            function setNeedsAuthorizingState() {
                document.body.classList.add('is-needingAuthorization');
            }

            gapi.analytics.auth.on('signIn', setSignedInState);
            gapi.analytics.auth.on('signOut', setSignedOutState);
            gapi.analytics.auth.once('needsAuthorization', setNeedsAuthorizingState);
            gapi.analytics.auth.once('error', setNeedsAuthorizingState);

            // Authorize this user with the client ID in sitemap.yaml
            gapi.analytics.auth.authorize({

                container: 'embed-api-auth-container',
                userInfoLabel: '',
                clientid: '793177639245-olst43lspv93vkoql0b9l26hmpf9kfmv.apps.googleusercontent.com',
            });
        });

    </script>

    <style> .gapi-analytics-data-chart .google-visualization-table{border:0;z-index:0}.gapi-analytics-data-chart .google-visualization-table-table{background:#fff;border-collapse:collapse;border-spacing:0;font:inherit;cursor:default;width:100%!important}.gapi-analytics-data-chart .google-visualization-table-table *{font:inherit;vertical-align:inherit}.gapi-analytics-data-chart .google-visualization-table-sortind{color:silver;display:inline-block;font:1em/0 Arial,sans-serif;margin:0 0 0 .5em;padding:0}.gapi-analytics-data-chart .google-visualization-table-td-bool,.gapi-analytics-data-chart .google-visualization-table-td-center,.gapi-analytics-data-chart .google-visualization-table-td-number{text-align:right}.gapi-analytics-data-chart .gapi-analytics-data-chart-styles-table-tr-odd{background:#f8f8f8}.gapi-analytics-data-chart .gapi-analytics-data-chart-styles-table-tr-over{background-color:#f0f0f0}.gapi-analytics-data-chart .gapi-analytics-data-chart-styles-table-tr-sel{background-color:#ffffc0}.gapi-analytics-data-chart .gapi-analytics-data-chart-styles-table-tr-even:last-child,.gapi-analytics-data-chart .gapi-analytics-data-chart-styles-table-tr-odd:last-child{border-bottom:1px solid #e8e8e8}.gapi-analytics-data-chart .gapi-analytics-data-chart-styles-table-th{border:0;border-bottom:1px solid #a8a8a8;font-weight:700;padding:.6em 1em;text-align:left;white-space:nowrap}.gapi-analytics-data-chart .gapi-analytics-data-chart-styles-table-td{border:0;border-left:1px solid #e8e8e8;padding:.6em 1em}.gapi-analytics-data-chart .gapi-analytics-data-chart-styles-table-td:first-child{border-left:0}</style><style type="text/css">
        @font-face {
            font-weight: 400;
            font-style:  normal;
            font-family: 'Circular-Loom';

            src: url('https://cdn.loom.com/assets/fonts/circular/CircularXXWeb-Book-cd7d2bcec649b1243839a15d5eb8f0a3.woff2') format('woff2');
        }

        @font-face {
            font-weight: 500;
            font-style:  normal;
            font-family: 'Circular-Loom';

            src: url('https://cdn.loom.com/assets/fonts/circular/CircularXXWeb-Medium-d74eac43c78bd5852478998ce63dceb3.woff2') format('woff2');
        }

        @font-face {
            font-weight: 700;
            font-style:  normal;
            font-family: 'Circular-Loom';

            src: url('https://cdn.loom.com/assets/fonts/circular/CircularXXWeb-Bold-83b8ceaf77f49c7cffa44107561909e4.woff2') format('woff2');
        }

        @font-face {
            font-weight: 900;
            font-style:  normal;
            font-family: 'Circular-Loom';

            src: url('https://cdn.loom.com/assets/fonts/circular/CircularXXWeb-Black-bf067ecb8aa777ceb6df7d72226febca.woff2') format('woff2');
        }</style><style> .gapi-analytics-auth-styles-signinbutton{display:inline-block;background:#f7991c;color:#fff;width:200px;border-radius:2px;white-space:nowrap}.gapi-analytics-auth-styles-signinbutton:hover{background:#ff9d27;cursor:hand}.gapi-analytics-auth-styles-signinbutton-image{background:url("//www.gstatic.com/analytics-api/access-analytics-iconv1.png") transparent 5px 50% no-repeat;display:inline-block;vertical-align:middle;width:30px;height:30px;border-right:#db8321 1px solid}.gapi-analytics-auth-styles-signinbutton-buttonText{display:inline-block;vertical-align:middle;padding-left:15px;padding-right:15px;font-size:12px;font-weight:bold;font-family:Roboto,arial,sans-serif}.gapi-analytics-auth-styles-userinfo{width:200px;height:30px;font-size:12px;font-weight:bold;color:#0a5ae5;font-family:Roboto,arial,sans-serif;background:#f2f2f2;text-align:center;overflow:hidden;text-overflow:ellipsis;line-height:30px;white-space:nowrap}</style>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RZG3PVVMWE"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-RZG3PVVMWE');
    </script>
</head>
<body class="Site is-loaded is-authorized">

<aside class="Site-sidebar" id="sidebar">
    <header class="NavHeader">
        <a class="NavHeader-homeLink" href="/">
    <span class="NavHeader-homeIcon">
      <svg class="Icon" viewBox="0 0 24 24">
        <use xlink:href="/public/images/icons.svg#icon-home"></use>
      </svg>
    </span>
            <h1 class="NavHeader-title">Home</h1>
        </a>
        <span class="NavHeader-controls" id="sidebar-close">
    <span class="NavHeader-controlsIcon">
      <svg class="Icon" viewBox="0 0 24 24">
        <use xlink:href="/public/images/icons.svg#icon-arrow-back"></use>
      </svg>
    </span>
  </span>
    </header>
    <nav class="Nav">

        <section class="Nav-section">
            <h1 class="Nav-category">Demos &amp; Tools</h1>
            <ol>


                <li>
                    <a class="Nav-link" href="/autotrack/">Autotrack

                    </a>

                </li>



                <li>
                    <a class="Nav-link" href="/account-explorer/">Account Explorer

                    </a>

                </li>



                <li>
                    <a class="Nav-link" href="/campaign-url-builder/">Campaign URL Builder

                    </a>

                </li>



                <li>
                    <a class="Nav-link" href="/dimensions-metrics-explorer/">Dimensions &amp; Metrics Explorer

                        <span class="Nav-status">updated</span>

                    </a>

                </li>



                <li>
                    <a class="Nav-link" href="/embed-api/">Embed API

                    </a>

                    <ol>

                        <li>
                            <a class="Nav-link  Nav-link--nested" href="/embed-api/basic-dashboard/">Basic Dashboard

                            </a>
                        </li>

                        <li>
                            <a class="Nav-link  Nav-link--nested" href="/embed-api/multiple-views/">Multiple Views

                            </a>
                        </li>

                        <li>
                            <a class="Nav-link  Nav-link--nested" href="/embed-api/interactive-charts/">Interactive Charts

                            </a>
                        </li>

                        <li>
                            <a class="Nav-link  Nav-link--nested" href="/embed-api/custom-components/">Working with Custom Components

                            </a>
                        </li>

                        <li>
                            <a class="Nav-link  Nav-link--nested Nav-link--selected" href="/embed-api/third-party-visualizations/">Third Party Visualizations

                            </a>
                        </li>

                        <li>
                            <a class="Nav-link  Nav-link--nested" href="/embed-api/server-side-authorization/">Server-side Authorization

                            </a>
                        </li>

                    </ol>

                </li>



                <li>
                    <a class="Nav-link" href="/enhanced-ecommerce/">Enhanced Ecommerce

                        <span class="Nav-status">updated</span>

                    </a>

                </li>



                <li>
                    <a class="Nav-link" href="/ga4-event-builder/">GA4 Event Builder

                    </a>

                </li>



                <li>
                    <a class="Nav-link" href="/hit-builder/">Hit Builder

                    </a>

                </li>



                <li>
                    <a class="Nav-link" href="/query-explorer/">Query Explorer

                    </a>

                </li>



                <li>
                    <a class="Nav-link" href="/request-composer/">Request Composer

                    </a>

                </li>



                <li>
                    <a class="Nav-link" href="/spreadsheet-add-on/">Spreadsheet Add-on

                    </a>

                </li>



                <li>
                    <a class="Nav-link" href="/tag-assistant/">Tag Assistant

                    </a>

                </li>



                <li>
                    <a class="Nav-link" href="/usage-trends/">Usage Trends

                    </a>

                </li>


            </ol>
        </section>

        <section class="Nav-section">
            <h1 class="Nav-category">Resources</h1>
            <ol>
                <li><a class="Nav-link" href="/#about">About this Site</a></li>
                <li><a class="Nav-link" href="/#help">Help &amp; Feedback</a></li>
            </ol>
        </section>

    </nav>
</aside>





<main class="Site-main">
    <header class="Header" id="header">

        <div class="Header-block">
    <span class="Header-menu" id="header-menu">
      <span class="Header-menuIcon">
        <svg class="Icon" viewBox="0 0 24 24">
          <use xlink:href="/public/images/icons.svg#icon-menu"></use>
        </svg>
      </span>
    </span>

            <div class="Logo" title="Google Analytics Demos and Tools">
                <div class="Logo-full">
                    <svg viewBox="0 0 303 26">
                        <use xlink:href="/public/images/icons.svg#ga-developer-logo"></use>
                    </svg>
                </div>
                <div class="Logo-partial">
                    <svg viewBox="0 0 111 16">
                        <use xlink:href="/public/images/icons.svg#google-analytics-text"></use>
                    </svg>
                </div>
            </div>


            <div class="Header-user" id="header-user">
        <span class="Header-userIcon">
          <svg class="Icon" viewBox="0 0 24 24">
            <use xlink:href="/public/images/icons.svg#icon-person"></use>
          </svg>
        </span>
            </div>


            <div class="u-hidden u-lg-block">
                <div class="Titles Titles--hero">
                    <h1 class="Titles-main">Embed API</h1>

                    <div class="Titles-sub">Third Party Visualizations</div>


                </div>
            </div>

        </div>


        <aside class="Header-auth" id="header-auth">
            <div class="Header-embedApi" id="embed-api-auth-container" ga-on="click" ga-event-category="User" ga-event-label="auth" ga-event-action="signin">
                <div style="display: none;"><div class="gapi-analytics-auth-styles-signinbutton gapi-analytics-auth-styles-signinbutton:hover" title="Access Google Analytics"><span class="gapi-analytics-auth-styles-signinbutton-image"></span><span class="gapi-analytics-auth-styles-signinbutton-buttonText">Access Google Analytics</span></div></div><div style="display: block;">artemr446@gmail.com</div></div>
            <button class="Header-signOut LinkButton" id="header-sign-out" ga-on="click" ga-event-category="User" ga-event-label="auth" ga-event-action="signout">
                Sign Out
            </button>
        </aside>


        <div class="ProgressBar Header-progressIndicator"></div></header>
    <div class="Content">
        <div class="u-lg-hidden">
            <div class="Titles Titles--hero">
                <h1 class="Titles-main">Embed API</h1>

                <div class="Titles-sub">Third Party Visualizations</div>


            </div>
        </div>



        <section>
            <h2>Demo Overview</h2>
            <p>The Embed API make it easy to query data and display it in a Google Chart. But it also allows you to access the raw data so you can display it however you want. This example uses the <a href="http://www.chartjs.org/">Chart.js</a> visualization library.</p>
            <p>The Embed API is built on top of the <a href="https://developers.google.com/api-client-library/javascript/">Google APIs client library</a>, which means you don't just get access to the reporting API, you get access to everything.

            </p><p>In addition to showing Chart.js visualizations, this example uses the underlying client library to query data from the <a href="https://developers.google.com/analytics/devguides/reporting/realtime/">Real Time Reporting API</a>.
        </p></section>

        <div class="Dashboard Dashboard--full">
            <header class="Dashboard-header">
                <ul class="FlexGrid">
                    <li class="FlexGrid-item">
                        <div class="Titles">
                            <h1 class="Titles-main" id="view-name">artsiomrabchanka.github.io (Все данные по веб-сайту)</h1>
                            <div class="Titles-sub">Various visualizations</div>
                        </div>
                    </li>
                    <li class="FlexGrid-item FlexGrid-item--fixed">
                        <div id="active-users-container"><div class="ActiveUsers">Active Users: <b class="ActiveUsers-value">0</b></div></div>
                    </li>
                </ul>
                <div id="view-selector-container"><div class="ViewSelector2">  <div class="ViewSelector2-item">    <label>Account</label>    <select class="FormField"><option selected="" value="190003462">
                    artsiomrabchanka.github.io
                </option></select>  </div>  <div class="ViewSelector2-item">    <label>Property</label>    <select class="FormField"><option selected="" value="UA-190003462-1">
                    artsiomrabchanka.github.io
                </option></select>  </div>  <div class="ViewSelector2-item">    <label>View</label>    <select class="FormField"><option selected="" value="237796885">
                    Все данные по веб-сайту
                </option></select>  </div></div></div>
            </header>

            <ul class="FlexGrid FlexGrid--halves">
                <li class="FlexGrid-item">
                    <div class="Chartjs">
                        <header class="Titles">
                            <h1 class="Titles-main">This Week vs Last Week</h1>
                            <div class="Titles-sub">By sessions</div>
                        </header>
                        <figure class="Chartjs-figure" id="chart-1-container"></figure>
                        <ol class="Chartjs-legend" id="legend-1-container"></ol>
                    </div>
                </li>
                <li class="FlexGrid-item">
                    <div class="Chartjs">
                        <header class="Titles">
                            <h1 class="Titles-main">This Year vs Last Year</h1>
                            <div class="Titles-sub">By users</div>
                        </header>
                        <figure class="Chartjs-figure" id="chart-2-container"></figure>
                        <ol class="Chartjs-legend" id="legend-2-container"></ol>
                    </div>
                </li>
                <li class="FlexGrid-item">
                    <div class="Chartjs">
                        <header class="Titles">
                            <h1 class="Titles-main">Top Browsers</h1>
                            <div class="Titles-sub">By pageview</div>
                        </header>
                        <figure class="Chartjs-figure" id="chart-3-container"></figure>
                        <ol class="Chartjs-legend" id="legend-3-container"></ol>
                    </div>
                </li>
                <li class="FlexGrid-item">
                    <div class="Chartjs">
                        <header class="Titles">
                            <h1 class="Titles-main">Top Countries</h1>
                            <div class="Titles-sub">By sessions</div>
                        </header>
                        <figure class="Chartjs-figure" id="chart-4-container"></figure>
                        <ol class="Chartjs-legend" id="legend-4-container"></ol>
                    </div>
                </li>
            </ul>
        </div>

        <section>
            <h2>How it works</h2>

            <p>You can recreate the demo above by copy and pasting the following code into an HTML file running on a web server. Feel free to add additional CSS to spice it up a bit!</p>

            <p>If you want to know more, check out the <a href="https://developers.google.com/analytics/devguides/reporting/embed/">Embed API documentation</a> on our developers site.</p>

            <h3>Step 1: Load the Embed API library.</h3>

            <pre class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">w,d,s,g,js,fs</span>)</span>{
  g=w.gapi||(w.gapi={});g.analytics={<span class="hljs-attr">q</span>:[],<span class="hljs-attr">ready</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>)</span>{<span class="hljs-keyword">this</span>.q.push(f);}};
  js=d.createElement(s);fs=d.getElementsByTagName(s)[<span class="hljs-number">0</span>];
  js.src=<span class="hljs-string">'https://apis.google.com/js/platform.js'</span>;
  fs.parentNode.insertBefore(js,fs);js.onload=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{g.load(<span class="hljs-string">'analytics'</span>);};
}(<span class="hljs-built_in">window</span>,<span class="hljs-built_in">document</span>,<span class="hljs-string">'script'</span>));
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></pre>

            <h3>Step 2: Add HTML containers to host the dashboard components.</h3>

            <pre class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"embed-api-auth-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"view-selector-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"view-name"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"active-users-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Chartjs"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>This Week vs Last Week (by sessions)<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">figure</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Chartjs-figure"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"chart-1-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Chartjs-legend"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"legend-1-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Chartjs"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>This Year vs Last Year (by users)<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">figure</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Chartjs-figure"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"chart-2-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Chartjs-legend"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"legend-2-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Chartjs"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Top Browsers (by pageview)<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">figure</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Chartjs-figure"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"chart-3-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Chartjs-legend"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"legend-3-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Chartjs"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>Top Countries (by sessions)<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">figure</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Chartjs-figure"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"chart-4-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"Chartjs-legend"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"legend-4-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></pre>

            <h3>Step 3: Load the components and their dependencies.</h3>

            <pre class="hljs xml"><span class="hljs-comment">&lt;!-- This demo uses the Chart.js graphing library and Moment.js to do date
     formatting and manipulation. --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- Include the ViewSelector2 component script. --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/public/javascript/embed-api/components/view-selector2.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- Include the DateRangeSelector component script. --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/public/javascript/embed-api/components/date-range-selector.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- Include the ActiveUsers component script. --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/public/javascript/embed-api/components/active-users.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- Include the CSS that styles the charts. --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/public/css/chartjs-visualizations.css"</span>&gt;</span></pre>

            <h3>Step 4: Write the dashboard code.</h3>

            <pre class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">

<span class="hljs-comment">// == NOTE ==</span>
<span class="hljs-comment">// This code uses ES6 promises. If you want to use this code in a browser</span>
<span class="hljs-comment">// that doesn't supporting promises natively, you'll have to include a polyfill.</span>

gapi.analytics.ready(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-comment">/**
   * Authorize the user immediately if the user has already granted access.
   * If no access has been created, render an authorize button inside the
   * element with the ID "embed-api-auth-container".
   */</span>
  gapi.analytics.auth.authorize({
    <span class="hljs-attr">container</span>: <span class="hljs-string">'embed-api-auth-container'</span>,
    <span class="hljs-attr">clientid</span>: <span class="hljs-string">'REPLACE WITH YOUR CLIENT ID'</span>
  });


  <span class="hljs-comment">/**
   * Create a new ActiveUsers instance to be rendered inside of an
   * element with the id "active-users-container" and poll for changes every
   * five seconds.
   */</span>
  <span class="hljs-keyword">var</span> activeUsers = <span class="hljs-keyword">new</span> gapi.analytics.ext.ActiveUsers({
    <span class="hljs-attr">container</span>: <span class="hljs-string">'active-users-container'</span>,
    <span class="hljs-attr">pollingInterval</span>: <span class="hljs-number">5</span>
  });


  <span class="hljs-comment">/**
   * Add CSS animation to visually show the when users come and go.
   */</span>
  activeUsers.once(<span class="hljs-string">'success'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> element = <span class="hljs-keyword">this</span>.container.firstChild;
    <span class="hljs-keyword">var</span> timeout;

    <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
      <span class="hljs-keyword">var</span> element = <span class="hljs-keyword">this</span>.container.firstChild;
      <span class="hljs-keyword">var</span> animationClass = data.delta &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'is-increasing'</span> : <span class="hljs-string">'is-decreasing'</span>;
      element.className += (<span class="hljs-string">' '</span> + animationClass);

      clearTimeout(timeout);
      timeout = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        element.className =
            element.className.replace(<span class="hljs-regexp">/ is-(increasing|decreasing)/g</span>, <span class="hljs-string">''</span>);
      }, <span class="hljs-number">3000</span>);
    });
  });


  <span class="hljs-comment">/**
   * Create a new ViewSelector2 instance to be rendered inside of an
   * element with the id "view-selector-container".
   */</span>
  <span class="hljs-keyword">var</span> viewSelector = <span class="hljs-keyword">new</span> gapi.analytics.ext.ViewSelector2({
    <span class="hljs-attr">container</span>: <span class="hljs-string">'view-selector-container'</span>,
  })
  .execute();


  <span class="hljs-comment">/**
   * Update the activeUsers component, the Chartjs charts, and the dashboard
   * title whenever the user changes the view.
   */</span>
  viewSelector.on(<span class="hljs-string">'viewChange'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
    <span class="hljs-keyword">var</span> title = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'view-name'</span>);
    title.textContent = data.property.name + <span class="hljs-string">' ('</span> + data.view.name + <span class="hljs-string">')'</span>;

    <span class="hljs-comment">// Start tracking active users for this view.</span>
    activeUsers.set(data).execute();

    <span class="hljs-comment">// Render all the of charts for this view.</span>
    renderWeekOverWeekChart(data.ids);
    renderYearOverYearChart(data.ids);
    renderTopBrowsersChart(data.ids);
    renderTopCountriesChart(data.ids);
  });


  <span class="hljs-comment">/**
   * Draw the a chart.js line chart with data from the specified view that
   * overlays session data for the current week over session data for the
   * previous week.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderWeekOverWeekChart</span>(<span class="hljs-params">ids</span>) </span>{

    <span class="hljs-comment">// Adjust `now` to experiment with different days, for testing only...</span>
    <span class="hljs-keyword">var</span> now = moment(); <span class="hljs-comment">// .subtract(3, 'day');</span>

    <span class="hljs-keyword">var</span> thisWeek = query({
      <span class="hljs-string">'ids'</span>: ids,
      <span class="hljs-string">'dimensions'</span>: <span class="hljs-string">'ga:date,ga:nthDay'</span>,
      <span class="hljs-string">'metrics'</span>: <span class="hljs-string">'ga:sessions'</span>,
      <span class="hljs-string">'start-date'</span>: moment(now).subtract(<span class="hljs-number">1</span>, <span class="hljs-string">'day'</span>).day(<span class="hljs-number">0</span>).format(<span class="hljs-string">'YYYY-MM-DD'</span>),
      <span class="hljs-string">'end-date'</span>: moment(now).format(<span class="hljs-string">'YYYY-MM-DD'</span>)
    });

    <span class="hljs-keyword">var</span> lastWeek = query({
      <span class="hljs-string">'ids'</span>: ids,
      <span class="hljs-string">'dimensions'</span>: <span class="hljs-string">'ga:date,ga:nthDay'</span>,
      <span class="hljs-string">'metrics'</span>: <span class="hljs-string">'ga:sessions'</span>,
      <span class="hljs-string">'start-date'</span>: moment(now).subtract(<span class="hljs-number">1</span>, <span class="hljs-string">'day'</span>).day(<span class="hljs-number">0</span>).subtract(<span class="hljs-number">1</span>, <span class="hljs-string">'week'</span>)
          .format(<span class="hljs-string">'YYYY-MM-DD'</span>),
      <span class="hljs-string">'end-date'</span>: moment(now).subtract(<span class="hljs-number">1</span>, <span class="hljs-string">'day'</span>).day(<span class="hljs-number">6</span>).subtract(<span class="hljs-number">1</span>, <span class="hljs-string">'week'</span>)
          .format(<span class="hljs-string">'YYYY-MM-DD'</span>)
    });

    <span class="hljs-built_in">Promise</span>.all([thisWeek, lastWeek]).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{

      <span class="hljs-keyword">var</span> data1 = results[<span class="hljs-number">0</span>].rows.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>) </span>{ <span class="hljs-keyword">return</span> +row[<span class="hljs-number">2</span>]; });
      <span class="hljs-keyword">var</span> data2 = results[<span class="hljs-number">1</span>].rows.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>) </span>{ <span class="hljs-keyword">return</span> +row[<span class="hljs-number">2</span>]; });
      <span class="hljs-keyword">var</span> labels = results[<span class="hljs-number">1</span>].rows.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>) </span>{ <span class="hljs-keyword">return</span> +row[<span class="hljs-number">0</span>]; });

      labels = labels.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">label</span>) </span>{
        <span class="hljs-keyword">return</span> moment(label, <span class="hljs-string">'YYYYMMDD'</span>).format(<span class="hljs-string">'ddd'</span>);
      });

      <span class="hljs-keyword">var</span> data = {
        <span class="hljs-attr">labels</span> : labels,
        <span class="hljs-attr">datasets</span> : [
          {
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Last Week'</span>,
            <span class="hljs-attr">fillColor</span> : <span class="hljs-string">'rgba(220,220,220,0.5)'</span>,
            <span class="hljs-attr">strokeColor</span> : <span class="hljs-string">'rgba(220,220,220,1)'</span>,
            <span class="hljs-attr">pointColor</span> : <span class="hljs-string">'rgba(220,220,220,1)'</span>,
            <span class="hljs-attr">pointStrokeColor</span> : <span class="hljs-string">'#fff'</span>,
            <span class="hljs-attr">data</span> : data2
          },
          {
            <span class="hljs-attr">label</span>: <span class="hljs-string">'This Week'</span>,
            <span class="hljs-attr">fillColor</span> : <span class="hljs-string">'rgba(151,187,205,0.5)'</span>,
            <span class="hljs-attr">strokeColor</span> : <span class="hljs-string">'rgba(151,187,205,1)'</span>,
            <span class="hljs-attr">pointColor</span> : <span class="hljs-string">'rgba(151,187,205,1)'</span>,
            <span class="hljs-attr">pointStrokeColor</span> : <span class="hljs-string">'#fff'</span>,
            <span class="hljs-attr">data</span> : data1
          }
        ]
      };

      <span class="hljs-keyword">new</span> Chart(makeCanvas(<span class="hljs-string">'chart-1-container'</span>)).Line(data);
      generateLegend(<span class="hljs-string">'legend-1-container'</span>, data.datasets);
    });
  }


  <span class="hljs-comment">/**
   * Draw the a chart.js bar chart with data from the specified view that
   * overlays session data for the current year over session data for the
   * previous year, grouped by month.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderYearOverYearChart</span>(<span class="hljs-params">ids</span>) </span>{

    <span class="hljs-comment">// Adjust `now` to experiment with different days, for testing only...</span>
    <span class="hljs-keyword">var</span> now = moment(); <span class="hljs-comment">// .subtract(3, 'day');</span>

    <span class="hljs-keyword">var</span> thisYear = query({
      <span class="hljs-string">'ids'</span>: ids,
      <span class="hljs-string">'dimensions'</span>: <span class="hljs-string">'ga:month,ga:nthMonth'</span>,
      <span class="hljs-string">'metrics'</span>: <span class="hljs-string">'ga:users'</span>,
      <span class="hljs-string">'start-date'</span>: moment(now).date(<span class="hljs-number">1</span>).month(<span class="hljs-number">0</span>).format(<span class="hljs-string">'YYYY-MM-DD'</span>),
      <span class="hljs-string">'end-date'</span>: moment(now).format(<span class="hljs-string">'YYYY-MM-DD'</span>)
    });

    <span class="hljs-keyword">var</span> lastYear = query({
      <span class="hljs-string">'ids'</span>: ids,
      <span class="hljs-string">'dimensions'</span>: <span class="hljs-string">'ga:month,ga:nthMonth'</span>,
      <span class="hljs-string">'metrics'</span>: <span class="hljs-string">'ga:users'</span>,
      <span class="hljs-string">'start-date'</span>: moment(now).subtract(<span class="hljs-number">1</span>, <span class="hljs-string">'year'</span>).date(<span class="hljs-number">1</span>).month(<span class="hljs-number">0</span>)
          .format(<span class="hljs-string">'YYYY-MM-DD'</span>),
      <span class="hljs-string">'end-date'</span>: moment(now).date(<span class="hljs-number">1</span>).month(<span class="hljs-number">0</span>).subtract(<span class="hljs-number">1</span>, <span class="hljs-string">'day'</span>)
          .format(<span class="hljs-string">'YYYY-MM-DD'</span>)
    });

    <span class="hljs-built_in">Promise</span>.all([thisYear, lastYear]).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) </span>{
      <span class="hljs-keyword">var</span> data1 = results[<span class="hljs-number">0</span>].rows.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>) </span>{ <span class="hljs-keyword">return</span> +row[<span class="hljs-number">2</span>]; });
      <span class="hljs-keyword">var</span> data2 = results[<span class="hljs-number">1</span>].rows.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>) </span>{ <span class="hljs-keyword">return</span> +row[<span class="hljs-number">2</span>]; });
      <span class="hljs-keyword">var</span> labels = [<span class="hljs-string">'Jan'</span>,<span class="hljs-string">'Feb'</span>,<span class="hljs-string">'Mar'</span>,<span class="hljs-string">'Apr'</span>,<span class="hljs-string">'May'</span>,<span class="hljs-string">'Jun'</span>,
                    <span class="hljs-string">'Jul'</span>,<span class="hljs-string">'Aug'</span>,<span class="hljs-string">'Sep'</span>,<span class="hljs-string">'Oct'</span>,<span class="hljs-string">'Nov'</span>,<span class="hljs-string">'Dec'</span>];

      <span class="hljs-comment">// Ensure the data arrays are at least as long as the labels array.</span>
      <span class="hljs-comment">// Chart.js bar charts don't (yet) accept sparse datasets.</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = labels.length; i &lt; len; i++) {
        <span class="hljs-keyword">if</span> (data1[i] === <span class="hljs-literal">undefined</span>) data1[i] = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">if</span> (data2[i] === <span class="hljs-literal">undefined</span>) data2[i] = <span class="hljs-literal">null</span>;
      }

      <span class="hljs-keyword">var</span> data = {
        <span class="hljs-attr">labels</span> : labels,
        <span class="hljs-attr">datasets</span> : [
          {
            <span class="hljs-attr">label</span>: <span class="hljs-string">'Last Year'</span>,
            <span class="hljs-attr">fillColor</span> : <span class="hljs-string">'rgba(220,220,220,0.5)'</span>,
            <span class="hljs-attr">strokeColor</span> : <span class="hljs-string">'rgba(220,220,220,1)'</span>,
            <span class="hljs-attr">data</span> : data2
          },
          {
            <span class="hljs-attr">label</span>: <span class="hljs-string">'This Year'</span>,
            <span class="hljs-attr">fillColor</span> : <span class="hljs-string">'rgba(151,187,205,0.5)'</span>,
            <span class="hljs-attr">strokeColor</span> : <span class="hljs-string">'rgba(151,187,205,1)'</span>,
            <span class="hljs-attr">data</span> : data1
          }
        ]
      };

      <span class="hljs-keyword">new</span> Chart(makeCanvas(<span class="hljs-string">'chart-2-container'</span>)).Bar(data);
      generateLegend(<span class="hljs-string">'legend-2-container'</span>, data.datasets);
    })
    .catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
      <span class="hljs-built_in">console</span>.error(err.stack);
    });
  }


  <span class="hljs-comment">/**
   * Draw the a chart.js doughnut chart with data from the specified view that
   * show the top 5 browsers over the past seven days.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderTopBrowsersChart</span>(<span class="hljs-params">ids</span>) </span>{

    query({
      <span class="hljs-string">'ids'</span>: ids,
      <span class="hljs-string">'dimensions'</span>: <span class="hljs-string">'ga:browser'</span>,
      <span class="hljs-string">'metrics'</span>: <span class="hljs-string">'ga:pageviews'</span>,
      <span class="hljs-string">'sort'</span>: <span class="hljs-string">'-ga:pageviews'</span>,
      <span class="hljs-string">'max-results'</span>: <span class="hljs-number">5</span>
    })
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{

      <span class="hljs-keyword">var</span> data = [];
      <span class="hljs-keyword">var</span> colors = [<span class="hljs-string">'#4D5360'</span>,<span class="hljs-string">'#949FB1'</span>,<span class="hljs-string">'#D4CCC5'</span>,<span class="hljs-string">'#E2EAE9'</span>,<span class="hljs-string">'#F7464A'</span>];

      response.rows.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row, i</span>) </span>{
        data.push({ <span class="hljs-attr">value</span>: +row[<span class="hljs-number">1</span>], <span class="hljs-attr">color</span>: colors[i], <span class="hljs-attr">label</span>: row[<span class="hljs-number">0</span>] });
      });

      <span class="hljs-keyword">new</span> Chart(makeCanvas(<span class="hljs-string">'chart-3-container'</span>)).Doughnut(data);
      generateLegend(<span class="hljs-string">'legend-3-container'</span>, data);
    });
  }


  <span class="hljs-comment">/**
   * Draw the a chart.js doughnut chart with data from the specified view that
   * compares sessions from mobile, desktop, and tablet over the past seven
   * days.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderTopCountriesChart</span>(<span class="hljs-params">ids</span>) </span>{
    query({
      <span class="hljs-string">'ids'</span>: ids,
      <span class="hljs-string">'dimensions'</span>: <span class="hljs-string">'ga:country'</span>,
      <span class="hljs-string">'metrics'</span>: <span class="hljs-string">'ga:sessions'</span>,
      <span class="hljs-string">'sort'</span>: <span class="hljs-string">'-ga:sessions'</span>,
      <span class="hljs-string">'max-results'</span>: <span class="hljs-number">5</span>
    })
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{

      <span class="hljs-keyword">var</span> data = [];
      <span class="hljs-keyword">var</span> colors = [<span class="hljs-string">'#4D5360'</span>,<span class="hljs-string">'#949FB1'</span>,<span class="hljs-string">'#D4CCC5'</span>,<span class="hljs-string">'#E2EAE9'</span>,<span class="hljs-string">'#F7464A'</span>];

      response.rows.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row, i</span>) </span>{
        data.push({
          <span class="hljs-attr">label</span>: row[<span class="hljs-number">0</span>],
          <span class="hljs-attr">value</span>: +row[<span class="hljs-number">1</span>],
          <span class="hljs-attr">color</span>: colors[i]
        });
      });

      <span class="hljs-keyword">new</span> Chart(makeCanvas(<span class="hljs-string">'chart-4-container'</span>)).Doughnut(data);
      generateLegend(<span class="hljs-string">'legend-4-container'</span>, data);
    });
  }


  <span class="hljs-comment">/**
   * Extend the Embed APIs `gapi.analytics.report.Data` component to
   * return a promise the is fulfilled with the value returned by the API.
   * @param {Object} params The request parameters.
   * @return {Promise} A promise.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">query</span>(<span class="hljs-params">params</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) </span>{
      <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">new</span> gapi.analytics.report.Data({<span class="hljs-attr">query</span>: params});
      data.once(<span class="hljs-string">'success'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{ resolve(response); })
          .once(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{ reject(response); })
          .execute();
    });
  }


  <span class="hljs-comment">/**
   * Create a new canvas inside the specified element. Set it to be the width
   * and height of its container.
   * @param {string} id The id attribute of the element to host the canvas.
   * @return {RenderingContext} The 2D canvas context.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeCanvas</span>(<span class="hljs-params">id</span>) </span>{
    <span class="hljs-keyword">var</span> container = <span class="hljs-built_in">document</span>.getElementById(id);
    <span class="hljs-keyword">var</span> canvas = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'canvas'</span>);
    <span class="hljs-keyword">var</span> ctx = canvas.getContext(<span class="hljs-string">'2d'</span>);

    container.innerHTML = <span class="hljs-string">''</span>;
    canvas.width = container.offsetWidth;
    canvas.height = container.offsetHeight;
    container.appendChild(canvas);

    <span class="hljs-keyword">return</span> ctx;
  }


  <span class="hljs-comment">/**
   * Create a visual legend inside the specified element based off of a
   * Chart.js dataset.
   * @param {string} id The id attribute of the element to host the legend.
   * @param {Array.&lt;Object&gt;} items A list of labels and colors for the legend.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generateLegend</span>(<span class="hljs-params">id, items</span>) </span>{
    <span class="hljs-keyword">var</span> legend = <span class="hljs-built_in">document</span>.getElementById(id);
    legend.innerHTML = items.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
      <span class="hljs-keyword">var</span> color = item.color || item.fillColor;
      <span class="hljs-keyword">var</span> label = item.label;
      <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;li&gt;&lt;i style="background:'</span> + color + <span class="hljs-string">'"&gt;&lt;/i&gt;'</span> +
          escapeHtml(label) + <span class="hljs-string">'&lt;/li&gt;'</span>;
    }).join(<span class="hljs-string">''</span>);
  }


  <span class="hljs-comment">// Set some global Chart.js defaults.</span>
  Chart.defaults.global.animationSteps = <span class="hljs-number">60</span>;
  Chart.defaults.global.animationEasing = <span class="hljs-string">'easeInOutQuart'</span>;
  Chart.defaults.global.responsive = <span class="hljs-literal">true</span>;
  Chart.defaults.global.maintainAspectRatio = <span class="hljs-literal">false</span>;


  <span class="hljs-comment">/**
   * Escapes a potentially unsafe HTML string.
   * @param {string} str An string that may contain HTML entities.
   * @return {string} The HTML-escaped string.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">escapeHtml</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">var</span> div = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
    div.appendChild(<span class="hljs-built_in">document</span>.createTextNode(str));
    <span class="hljs-keyword">return</span> div.innerHTML;
  }

});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></pre>

        </section>




        <aside id="tech-info" class="TechInfo">
            <svg class="TechInfo-icon" viewBox="0 0 24 24">
                <use xlink:href="/public/images/icons.svg#icon-info-outline"></use>
            </svg>
            <div class="TechInfo-content">
                <h1 class="TechInfo-title">Google Analytics technology used in this demo</h1>

                The Third Party Visualizations demo uses the <code>Data</code> component of the <a href="https://developers.google.com/analytics/devguides/reporting/embed/">Embed API</a>, which queries the <a href="https://developers.google.com/analytics/devguides/reporting/core/v3/">Core Reporting API</a> behind the scenes. It also uses a custom <code>ViewSelector2</code> component, which uses the <a href="https://developers.google.com/analytics/devguides/config/mgmt/">Management API</a> to get a list of accounts the current user can access. Lastly, it uses a custom <code>ActiveUsers</code> component to query the <a href="https://developers.google.com/analytics/devguides/reporting/realtime/">Real Time Reporting API</a> and see how many users are on the site now.

            </div>
        </aside>



    </div>
</main>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>


<!-- This demo uses the Chart.js graphing library and Moment.js to do date
     formatting and manipulation. -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>

<!-- Include the ViewSelector2 component script. -->
<script src="/public/javascript/embed-api/components/view-selector2.js"></script>

<!-- Include the DateRangeSelector component script. -->
<script src="/public/javascript/embed-api/components/date-range-selector.js"></script>

<!-- Include the ActiveUsers component script. -->
<script src="/public/javascript/embed-api/components/active-users.js"></script>

<!-- Include the CSS that styles the charts. -->
<link rel="stylesheet" href="/public/css/chartjs-visualizations.css">


<script src="/public/javascript/common.js"></script>
<script src="/public/javascript/index.js"></script>

<script src="/public/javascript/embed-api.js"></script>

<script>
    // == NOTE ==
    // This code uses ES6 promises. If you want to use this code in a browser
    // that doesn't supporting promises natively, you'll have to include a polyfill.

    gapi.analytics.ready(function() {

        /**
         * Authorize the user immediately if the user has already granted access.
         * If no access has been created, render an authorize button inside the
         * element with the ID "embed-api-auth-container".
         */
        gapi.analytics.auth.authorize({
            container: 'embed-api-auth-container',
            clientid: 'REPLACE WITH YOUR CLIENT ID'
        });


        /**
         * Create a new ActiveUsers instance to be rendered inside of an
         * element with the id "active-users-container" and poll for changes every
         * five seconds.
         */
        var activeUsers = new gapi.analytics.ext.ActiveUsers({
            container: 'active-users-container',
            pollingInterval: 5
        });


        /**
         * Add CSS animation to visually show the when users come and go.
         */
        activeUsers.once('success', function() {
            var element = this.container.firstChild;
            var timeout;

            this.on('change', function(data) {
                var element = this.container.firstChild;
                var animationClass = data.delta > 0 ? 'is-increasing' : 'is-decreasing';
                element.className += (' ' + animationClass);

                clearTimeout(timeout);
                timeout = setTimeout(function() {
                    element.className =
                        element.className.replace(/ is-(increasing|decreasing)/g, '');
                }, 3000);
            });
        });


        /**
         * Create a new ViewSelector2 instance to be rendered inside of an
         * element with the id "view-selector-container".
         */
        var viewSelector = new gapi.analytics.ext.ViewSelector2({
            container: 'view-selector-container',
        })
            .execute();


        /**
         * Update the activeUsers component, the Chartjs charts, and the dashboard
         * title whenever the user changes the view.
         */
        viewSelector.on('viewChange', function(data) {
            var title = document.getElementById('view-name');
            title.textContent = data.property.name + ' (' + data.view.name + ')';

            // Start tracking active users for this view.
            activeUsers.set(data).execute();

            // Render all the of charts for this view.
            renderWeekOverWeekChart(data.ids);
            renderYearOverYearChart(data.ids);
            renderTopBrowsersChart(data.ids);
            renderTopCountriesChart(data.ids);
        });


        /**
         * Draw the a chart.js line chart with data from the specified view that
         * overlays session data for the current week over session data for the
         * previous week.
         */
        function renderWeekOverWeekChart(ids) {

            // Adjust `now` to experiment with different days, for testing only...
            var now = moment(); // .subtract(3, 'day');

            var thisWeek = query({
                'ids': ids,
                'dimensions': 'ga:date,ga:nthDay',
                'metrics': 'ga:sessions',
                'start-date': moment(now).subtract(1, 'day').day(0).format('YYYY-MM-DD'),
                'end-date': moment(now).format('YYYY-MM-DD')
            });

            var lastWeek = query({
                'ids': ids,
                'dimensions': 'ga:date,ga:nthDay',
                'metrics': 'ga:sessions',
                'start-date': moment(now).subtract(1, 'day').day(0).subtract(1, 'week')
                    .format('YYYY-MM-DD'),
                'end-date': moment(now).subtract(1, 'day').day(6).subtract(1, 'week')
                    .format('YYYY-MM-DD')
            });

            Promise.all([thisWeek, lastWeek]).then(function(results) {

                var data1 = results[0].rows.map(function(row) { return +row[2]; });
                var data2 = results[1].rows.map(function(row) { return +row[2]; });
                var labels = results[1].rows.map(function(row) { return +row[0]; });

                labels = labels.map(function(label) {
                    return moment(label, 'YYYYMMDD').format('ddd');
                });

                var data = {
                    labels : labels,
                    datasets : [
                        {
                            label: 'Last Week',
                            fillColor : 'rgba(220,220,220,0.5)',
                            strokeColor : 'rgba(220,220,220,1)',
                            pointColor : 'rgba(220,220,220,1)',
                            pointStrokeColor : '#fff',
                            data : data2
                        },
                        {
                            label: 'This Week',
                            fillColor : 'rgba(151,187,205,0.5)',
                            strokeColor : 'rgba(151,187,205,1)',
                            pointColor : 'rgba(151,187,205,1)',
                            pointStrokeColor : '#fff',
                            data : data1
                        }
                    ]
                };

                new Chart(makeCanvas('chart-1-container')).Line(data);
                generateLegend('legend-1-container', data.datasets);
            });
        }


        /**
         * Draw the a chart.js bar chart with data from the specified view that
         * overlays session data for the current year over session data for the
         * previous year, grouped by month.
         */
        function renderYearOverYearChart(ids) {

            // Adjust `now` to experiment with different days, for testing only...
            var now = moment(); // .subtract(3, 'day');

            var thisYear = query({
                'ids': ids,
                'dimensions': 'ga:month,ga:nthMonth',
                'metrics': 'ga:users',
                'start-date': moment(now).date(1).month(0).format('YYYY-MM-DD'),
                'end-date': moment(now).format('YYYY-MM-DD')
            });

            var lastYear = query({
                'ids': ids,
                'dimensions': 'ga:month,ga:nthMonth',
                'metrics': 'ga:users',
                'start-date': moment(now).subtract(1, 'year').date(1).month(0)
                    .format('YYYY-MM-DD'),
                'end-date': moment(now).date(1).month(0).subtract(1, 'day')
                    .format('YYYY-MM-DD')
            });

            Promise.all([thisYear, lastYear]).then(function(results) {
                var data1 = results[0].rows.map(function(row) { return +row[2]; });
                var data2 = results[1].rows.map(function(row) { return +row[2]; });
                var labels = ['Jan','Feb','Mar','Apr','May','Jun',
                    'Jul','Aug','Sep','Oct','Nov','Dec'];

                // Ensure the data arrays are at least as long as the labels array.
                // Chart.js bar charts don't (yet) accept sparse datasets.
                for (var i = 0, len = labels.length; i < len; i++) {
                    if (data1[i] === undefined) data1[i] = null;
                    if (data2[i] === undefined) data2[i] = null;
                }

                var data = {
                    labels : labels,
                    datasets : [
                        {
                            label: 'Last Year',
                            fillColor : 'rgba(220,220,220,0.5)',
                            strokeColor : 'rgba(220,220,220,1)',
                            data : data2
                        },
                        {
                            label: 'This Year',
                            fillColor : 'rgba(151,187,205,0.5)',
                            strokeColor : 'rgba(151,187,205,1)',
                            data : data1
                        }
                    ]
                };

                new Chart(makeCanvas('chart-2-container')).Bar(data);
                generateLegend('legend-2-container', data.datasets);
            })
                .catch(function(err) {
                    console.error(err.stack);
                });
        }


        /**
         * Draw the a chart.js doughnut chart with data from the specified view that
         * show the top 5 browsers over the past seven days.
         */
        function renderTopBrowsersChart(ids) {

            query({
                'ids': ids,
                'dimensions': 'ga:browser',
                'metrics': 'ga:pageviews',
                'sort': '-ga:pageviews',
                'max-results': 5
            })
                .then(function(response) {

                    var data = [];
                    var colors = ['#4D5360','#949FB1','#D4CCC5','#E2EAE9','#F7464A'];

                    response.rows.forEach(function(row, i) {
                        data.push({ value: +row[1], color: colors[i], label: row[0] });
                    });

                    new Chart(makeCanvas('chart-3-container')).Doughnut(data);
                    generateLegend('legend-3-container', data);
                });
        }


        /**
         * Draw the a chart.js doughnut chart with data from the specified view that
         * compares sessions from mobile, desktop, and tablet over the past seven
         * days.
         */
        function renderTopCountriesChart(ids) {
            query({
                'ids': ids,
                'dimensions': 'ga:country',
                'metrics': 'ga:sessions',
                'sort': '-ga:sessions',
                'max-results': 5
            })
                .then(function(response) {

                    var data = [];
                    var colors = ['#4D5360','#949FB1','#D4CCC5','#E2EAE9','#F7464A'];

                    response.rows.forEach(function(row, i) {
                        data.push({
                            label: row[0],
                            value: +row[1],
                            color: colors[i]
                        });
                    });

                    new Chart(makeCanvas('chart-4-container')).Doughnut(data);
                    generateLegend('legend-4-container', data);
                });
        }


        /**
         * Extend the Embed APIs `gapi.analytics.report.Data` component to
         * return a promise the is fulfilled with the value returned by the API.
         * @param {Object} params The request parameters.
         * @return {Promise} A promise.
         */
        function query(params) {
            return new Promise(function(resolve, reject) {
                var data = new gapi.analytics.report.Data({query: params});
                data.once('success', function(response) { resolve(response); })
                    .once('error', function(response) { reject(response); })
                    .execute();
            });
        }


        /**
         * Create a new canvas inside the specified element. Set it to be the width
         * and height of its container.
         * @param {string} id The id attribute of the element to host the canvas.
         * @return {RenderingContext} The 2D canvas context.
         */
        function makeCanvas(id) {
            var container = document.getElementById(id);
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('2d');

            container.innerHTML = '';
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            container.appendChild(canvas);

            return ctx;
        }


        /**
         * Create a visual legend inside the specified element based off of a
         * Chart.js dataset.
         * @param {string} id The id attribute of the element to host the legend.
         * @param {Array.<Object>} items A list of labels and colors for the legend.
         */
        function generateLegend(id, items) {
            var legend = document.getElementById(id);
            legend.innerHTML = items.map(function(item) {
                var color = item.color || item.fillColor;
                var label = item.label;
                return '<li><i style="background:' + color + '"></i>' +
                    escapeHtml(label) + '</li>';
            }).join('');
        }


        // Set some global Chart.js defaults.
        Chart.defaults.global.animationSteps = 60;
        Chart.defaults.global.animationEasing = 'easeInOutQuart';
        Chart.defaults.global.responsive = true;
        Chart.defaults.global.maintainAspectRatio = false;


        /**
         * Escapes a potentially unsafe HTML string.
         * @param {string} str An string that may contain HTML entities.
         * @return {string} The HTML-escaped string.
         */
        function escapeHtml(str) {
            var div = document.createElement('div');
            div.appendChild(document.createTextNode(str));
            return div.innerHTML;
        }

    });
</script>



<iframe id="apiproxyb698216d4aa180535b5e960c375db09e891284fb0.2869262857" name="apiproxyb698216d4aa180535b5e960c375db09e891284fb0.2869262857" src="https://content.googleapis.com/static/proxy.html?usegapi=1&amp;jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.ru.cT5jUD76onk.O%2Fam%3DwQE%2Fd%3D1%2Fct%3Dzgms%2Frs%3DAGLTcCNdQpkLT0Yl7damoIUETGlxC8Grxw%2Fm%3D__features__#parent=https%3A%2F%2Fga-dev-tools.appspot.com&amp;rpctoken=770255632" tabindex="-1" aria-hidden="true" style="width: 1px; height: 1px; position: absolute; top: -100px; display: none;"></iframe><iframe id="ssIFrame_google" sandbox="allow-scripts allow-same-origin" aria-hidden="true" frame-border="0" style="position: absolute; width: 1px; height: 1px; left: -9999px; top: -9999px; right: -9999px; bottom: -9999px; display: none;" src="https://accounts.google.com/o/oauth2/iframe#origin=https%3A%2F%2Fga-dev-tools.appspot.com&amp;rpcToken=779565107.1398941"></iframe><iframe id="apiproxy4bdee1acb23fc4036495c0214c164d3f2de7c8130.25076482" name="apiproxy4bdee1acb23fc4036495c0214c164d3f2de7c8130.25076482" src="https://content-analytics.googleapis.com/static/proxy.html?usegapi=1&amp;jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.ru.cT5jUD76onk.O%2Fam%3DwQE%2Fd%3D1%2Fct%3Dzgms%2Frs%3DAGLTcCNdQpkLT0Yl7damoIUETGlxC8Grxw%2Fm%3D__features__#parent=https%3A%2F%2Fga-dev-tools.appspot.com&amp;rpctoken=1281911245" tabindex="-1" aria-hidden="true" style="width: 1px; height: 1px; position: absolute; top: -100px; display: none;"></iframe></body><loom-container id="lo-engage-ext-container"><div></div><loom-shadow classname="resolved"></loom-shadow></loom-container></html>